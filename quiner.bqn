#!/usr/bin/env cbqn

# Quiner interpreter (https://esolangs.org/wiki/Quiner)
# run with ./BQN quiner.bqn <flags>
# or cbqn quiner.bqn <flags>

"ERROR: No arguments given. Use -h for help." ! 0â‰ â‰ â€¢args
input â† {
  "-h": â€¢Out "  -h            displays this help
  -f '<file>' run a file
  -c '<code>' run some code"
  â€¢Exit@;
  "-f": "ERROR: No file given"!1<â‰ â€¢args
  â€¢FChars 1âŠ‘â€¢args;
  "-c": "ERROR: No code given"!1<â‰ â€¢args
  1âŠ‘â€¢args;
  "ERROR: Invalid flag given. Use -h for help."!0
}âŠ‘â€¢args
nl â† @+10
Split â† (âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=âŠ”âŠ¢
stdin â† ""
stdout â† ""

{
  ğ•Š âŸ¨code, data, i, jâŸ©:
  iâ€¿data â†© {
    ğ•Š indâ€¿data: # execute a single command.
    p â† ind+âŒŠÂ´"*,.></+"âŠËœindâ†“code
    nâ€¿l â† (0âŠ¸(10âŠ¸Ã—âŠ¸+ËœÂ´)â‹ˆâ‰ )'0'-Ëœ(âˆ§`(â‰¥âŸœ'0'âˆ§â‰¤âŸœ'9'))âŠ¸/âŒ½pâ†‘code
    nâ€¿l{
      0â€¿0 ğ•Š '+': 2â€¿1 ğ•Š '+';
      0â€¿0 ğ•Š ğ•©  : 1â€¿1 ğ•Š ğ•©;
      nâ€¿l ğ•Š '*': j âŒŠâ†© 0âŒˆn-Ëœâ‰ data, âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š ',': stdin {nlâˆ¾Ëœğ•©âˆ¾â€¢GetLine@} â€¢_while_ {n>â‰ ğ•©}â†© ,  ap â† nâ†‘stdin, stdinâ†“Ëœâ†©n, âŸ¨p+1, dataâˆ¾apâŸ©;
      nâ€¿l ğ•Š '.':
      stdout âˆ¾â†© (-n)â†‘data
      {(nlâ‰ Â¯1âŠ‘stdout)âˆ§âŠ‘nlâˆŠstdout ? sp â† nl Split stdout, â€¢OutÂ¨Â¯1â†“sp, stdout â†© Â¯1âŠ‘sp;@}
      âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š '>': âŸ¨p+n+1, dataâˆ¾nâ†‘(p+1)â†“codeâŸ©;
      nâ€¿l ğ•Š '<': âŸ¨p+1, dataâˆ¾(-(p-l)âŒŠn)â†‘(p-l)â†‘codeâŸ©;
      nâ€¿l ğ•Š '/': {'/'=(p+1)âŠ‘code ? âŸ¨p+1+n, dataâŸ©; âŸ¨p+1, dataâŸ©};
      nâ€¿l ğ•Š '+': âŸ¨p+1, ((-n)â†“data)âˆ¾@+256|0+Â´@-Ëœ(-n)â†‘dataâŸ©;
      ("ERROR: Expected command character"âˆ¾nlâˆ¾codeâˆ¾nlâˆ¾(p+1)â†‘'^')! 0
    }pâŠ‘code
  } â€¢_while_ {indâ€¿data: ind<â‰ code} iâ€¿data
  âŸ¨data, code, j, iâŸ©
} â€¢_while_ {inâ€¿coâ€¿iâ€¿j: i<â‰ in} âŸ¨input, "", 0, 0âŸ©

â€¢Out stdout