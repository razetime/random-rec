#!/usr/bin/env cbqn

# Quiner interpreter


# input â† {
#   "-h": â€¢Out "
#   -h            displays this help
#   -f ""<file>"" run a file
#   -c ""<code>"" run some code"
#   â€¢Exit@;
#   "-f": "ERROR: No file given"!1<â‰ â€¢args
#   â€¢FChars Â¯1â†“1â†“1âŠ‘â€¢args;
#   "-c": "ERROR: No code given"!1<â‰ â€¢args
#   Â¯1â†“1â†“1âŠ‘â€¢args
#   ğ•©: "ERROR: Invalid flag"!0
# }âŠ‘â€¢args
nl â† @+10
Split â† (âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=âŠ”âŠ¢
input â† ">>,9>#2<*2.99*" 
input â†© ",4>@@@A5+.*"
input â†© ",.99*014<4<4<"
#input â†© "4*4*4*4<4<4<"
stdin â† ""
stdout â† ""

{
  ğ•Š âŸ¨code, data, i, jâŸ©:
  #â€¢Show "---"
  iâ€¿data â†© {
    ğ•Š indâ€¿data: # execute a single command.
    p â† ind+âŒŠÂ´"*,.></+"âŠËœindâ†“code
    nâ€¿l â† (0âŠ¸(10âŠ¸Ã—âŠ¸+ËœÂ´)â‹ˆâ‰ )'0'-Ëœ(âˆ§`(â‰¥âŸœ'0'âˆ§â‰¤âŸœ'9'))âŠ¸/âŒ½pâ†‘code
    #â€¢Show âŸ¨"debug",ind, data, indâ†“codeâŸ©
    #â€¢Show stdinâ€¿stdout
    nâ€¿l{
      0â€¿0 ğ•Š '+': 2â€¿1 ğ•Š '+';
      0â€¿0 ğ•Š ğ•©  : 1â€¿1 ğ•Š ğ•©;
      nâ€¿l ğ•Š '*': j âŒŠâ†© 0âŒˆn-Ëœâ‰ data, âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š ',': stdin {nlâˆ¾Ëœğ•©âˆ¾â€¢GetLine@} â€¢_while_{n>â‰ ğ•©}â†© ,  ap â† nâ†‘stdin, stdinâ†“Ëœâ†©n, âŸ¨p+1, dataâˆ¾apâŸ©;
      nâ€¿l ğ•Š '.':
      stdout âˆ¾â†© (-n)â†‘data
      {(nlâ‰ Â¯1âŠ‘stdout)âˆ§âŠ‘nlâˆŠstdout ? sp â† nl Split stdout, â€¢OutÂ¨Â¯1â†“sp, stdout â†© Â¯1âŠ‘sp;@}
      âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š '>': âŸ¨p+n+1, dataâˆ¾nâ†‘(p+1)â†“codeâŸ©;
      nâ€¿l ğ•Š '<': âŸ¨p+1, dataâˆ¾(-(p-l)âŒŠn)â†‘(p-l)â†‘codeâŸ©;
      nâ€¿l ğ•Š '/': {'/'=(p+1)âŠ‘code ? âŸ¨p+1+n, dataâŸ©; âŸ¨p+1, dataâŸ©};
      nâ€¿l ğ•Š '+': âŸ¨p+1, ((-n)â†“data)âˆ¾@+256|0+Â´@-Ëœ(-n)â†‘dataâŸ©;
      ("ERROR: Expected command character"âˆ¾nlâˆ¾codeâˆ¾nlâˆ¾(p+1)â†‘'^')! 0
    }pâŠ‘code
  } â€¢_while_ {indâ€¿data: ind<â‰ code} iâ€¿data
  âŸ¨data, code, j, iâŸ©
  
} â€¢_while_ {inâ€¿coâ€¿iâ€¿j: i<â‰ in} âŸ¨input, "", 0, 0âŸ©