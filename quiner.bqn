#!/usr/bin/env cbqn

# Quiner interpreter (https://esolangs.org/wiki/Quiner)
# run with ./BQN quiner.bqn <flags>
# or cbqn quiner.bqn <flags>

"ERROR: No arguments given. Use -h for help." ! 0â‰ â‰ â€¢args
input â† {
  "-h": â€¢Out "  -h            displays this help
  -f '<file>' run a file
  -c '<code>' run some code"
  â€¢Exit@;
  "-f": "ERROR: No file given"!1<â‰ â€¢args
  â€¢FChars 1âŠ‘â€¢args;
  "-c": "ERROR: No code given"!1<â‰ â€¢args
  1âŠ‘â€¢args;
  "ERROR: Invalid flag given. Use -h for help."!0
}âŠ‘â€¢args
nl â† @+10
Split â† (âŠ¢-Ëœ+`Ã—Â¬)âˆ˜=âŠ”âŠ¢
stdin â† ""
stdout â† ""

{
  ğ•Š âŸ¨code, data, i, jâŸ©:
  iâ€¿data â†© {
    ğ•Š indâ€¿data: # execute a single command.
    p â† ind+âŒŠÂ´"*,.></+"âŠËœindâ†“code
    nâ€¿l â† (0âŠ¸(10âŠ¸Ã—âŠ¸+ËœÂ´)â‹ˆâ‰ )'0'-Ëœ(âˆ§`(â‰¥âŸœ'0'âˆ§â‰¤âŸœ'9'))âŠ¸/âŒ½pâ†‘code
    # For Debug:
    #â€¢Show codeâ€¿((-l+1)â†‘(p+1)â†‘code)â€¿dataâ€¿indâ€¿j
    nâ€¿l{
      0â€¿0 ğ•Š '+': 2â€¿1 ğ•Š '+';
      0â€¿0 ğ•Š ğ•©  : 1â€¿1 ğ•Š ğ•©;
      nâ€¿l ğ•Š '*': j âŒŠâ†© 0âŒˆn-Ëœâ‰ data, âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š ',': stdin {nlâˆ¾Ëœğ•©âˆ¾â€¢GetLine@} â€¢_while_ {n>â‰ ğ•©}â†© ,  ap â† nâ†‘stdin, stdinâ†“Ëœâ†©n, âŸ¨p+1, dataâˆ¾apâŸ©;
      nâ€¿l ğ•Š '.':
      â€¢Out (-n)â†‘data
      âŸ¨p+1, (-n)â†“dataâŸ©;
      nâ€¿l ğ•Š '>': âŸ¨(â‰ code)âŒŠp+n+1, dataâˆ¾ {(nâŒŠâ‰ ğ•©)â†‘ğ•©}(p+1)â†“codeâŸ©;
      nâ€¿l ğ•Š '<': âŸ¨p+1, dataâˆ¾(-(p-l)âŒŠn)â†‘(p-l)â†‘codeâŸ©;
      nâ€¿l ğ•Š '/': {'/'=(p+1)âŠ‘code ? âŸ¨(â‰ code)âŒŠp+2+n, dataâŸ©; âŸ¨p+1, dataâŸ©};
      nâ€¿l ğ•Š '+': âŸ¨p+1, ((-n)â†“data)âˆ¾@+256|0+Â´@-Ëœ(-n)â†‘dataâŸ©;
      ("ERROR: Expected command character"âˆ¾nlâˆ¾codeâˆ¾nlâˆ¾(p+1)â†‘'^')! 0
    }pâŠ‘code
  } â€¢_while_ {indâ€¿data: ind<â‰ code} iâ€¿data
  âŸ¨data, code, j, iâŸ©
} â€¢_while_ {inâ€¿coâ€¿iâ€¿j: i<â‰ in} âŸ¨input, "", 0, 0âŸ©

â€¢Out stdout

# a*	Remove the last a characters from the end of the data deque. If the data queue's instruction pointer now points to nothing, move it back to the end of the data deque.
# a,	Input a characters from standard input and append them to the end of the data deque.
# a.	Remove the last a characters from the end of the data deque and print them to standard output.
# a>	Append the following a characters to the end of the data deque and skip their execution.
# a<	Append the previous a characters to the end of the data deque (not counting a as part of the characters).
# a/?	If ? is the / character, skip the execution of the next a characters (not counting / as part of the characters). Otherwise, do nothing (and do not execute the ? character).
# a+	Remove the last a characters from the end of the data deque, add their ascii values together (overflowing at 256), and append the resulting sum as an ascii character to the data deque. The default value for a is 2.

#2>9/ ,4>@@@>5+ 99> 1>0.99// 1>1.004<4<4<
#13>Hello, World!13.